{% extends 'baseFront.html.twig' %}

{% block title %}{{ excursion.titre }} | TuniTrip{% endblock %}

{% block stylesheet %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />


<style>
/* HERO */
.home {
    position: relative;
    height: 420px;
    background: linear-gradient(rgba(28,34,40,0.5), rgba(28,34,40,0.5)), url('{{ asset('uploads/images/' ~ excursion.imagePrincipale) }}') center/cover no-repeat;
    background-size: cover;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
}
.home::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(25, 32, 38, 0.8);
}
.home_content {
    position: relative;
    z-index: 2;
    margin-top: 60px; 
}
.home_title {
    font-size: 40px;
    color: #D7B65D;
    font-weight: 700;
    text-transform: uppercase;
}
.home_content p {
    font-size: 1.05rem;
    margin: 0;
    color: rgba(255,255,255,.8);
}

/* CAROUSEL */
#galleryCarousel img {
    height: 420px;
    object-fit: cover;
    border-radius: 8px;
}

/* INFO BOX */
.info-box, .info-box-modern {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    border-left: 4px solid #d8b65d; /* accent dor√© */
}

.info-item i {
    color: #d8b65d; /* ic√¥nes importantes dor√©es */
    margin-right: 8px;
}

.info-item strong {
    color: #1c2228;
}


.info-item:last-child {
    border-bottom: none;
}


/* ACCORDIONS */
.accordion-button {
    font-weight: 600;
    font-size: 17px;
}

#map {
    height: 400px;
    width: 100%;
    border-radius: 10px;
    Z-index: 1; 
}

.btn-reserver, .btn-primary {
    background-color: #d8b65d; /* dor√© */
    color: #1c2228;
    border: none;
    font-weight: 600;
    border-radius: 12px;
    transition: all 0.3s;
}

.btn-reserver:hover, .btn-primary:hover {
    background-color: #c5a954; /* dor√© plus fonc√© au hover */
    color: #fff;
}

.link-modern {
    color: #1c2228;
    text-decoration: underline;
}

.link-modern:hover {
    color: #d8b65d;
}
.accordion-button {
    font-weight: 600;
    font-size: 17px;
    color: #1c2228;
}

.accordion-button:not(.collapsed) {
    background-color: #d8b65d;
    color: #1c2228;
}
.itinerary-step-trip {
    padding-left: 120px;
    position: relative;
}

.itinerary-step-trip:not(:last-child)::before {
    background: repeating-linear-gradient(
        to bottom,
        #d0d0d0 0px,
        #d0d0d0 8px,
        transparent 8px,
        transparent 12px
    );
}

.itinerary-icon-trip.number-icon {
    background: #d8b65d; /* dor√© pour les √©tapes */
    color: #1c2228;
}

.itinerary-icon-trip.start-icon, .itinerary-icon-trip.end-icon {
    background: #1c2228; /* sombre */
    color: #d8b65d; /* dor√© */
}
#map {
    border-radius: 10px;
    border: 2px solid #d8b65d;
}
.btn-recenter {
    background: #d8b65d;
    color: #1c2228;
    border: none;
}
.btn-recenter:hover {
    background: #c5a954;
    color: #fff;
}
body, p, .description, .stop-details {
    color: #1c2228;
    line-height: 1.6;
}

.toggle-description, .itinerary-link {
    color: #d8b65d;
}

.toggle-description:hover, .itinerary-link:hover {
    color: #1c2228;
}


.info-box-modern {
    background: #fff;
    border-radius: 16px;
    border: 1px solid #e5e5e5;
}

.icon-circle {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #f3f6f9;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
   
}

.link-modern {
    text-decoration: underline;
    color: #000;
    cursor: pointer;
}



/* Description en noir */
.description {
    color: #000; /* texte noir */
    display: -webkit-box;
    -webkit-line-clamp: 3; /* nombre de lignes visibles par d√©faut */
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.5;
}

/* Description √©tendue */
.description.expanded {
    -webkit-line-clamp: unset;
}

/* Lien Lire plus / Lire moins en noir et soulign√© */
.toggle-description {
    color: #000 !important;       /* couleur noire */
    text-decoration: underline !important; /* soulignement */
    cursor: pointer;
    display: inline-block;
    margin-top: 5px;
}

/* Container principal */
.itinerary-container-tripadvisor {
    position: relative;
    padding-left: 0;
    margin-top: 25px;
}

/* Chaque √©tape */
.itinerary-step-trip {
    position: relative;
    padding-left: 120px;
    padding-bottom: 40px;
    padding-top: 5px;
}

.itinerary-step-trip:not(:last-child)::before {
    content: '';
    position: absolute;
    left: 37px;
    top: 45px;
    bottom: -5px;
    width: 2px;
    background: repeating-linear-gradient(
        to bottom,
        #d0d0d0 0px,
        #d0d0d0 8px,
        transparent 8px,
        transparent 12px
    );
}

/* Ic√¥nes */
.itinerary-icon-trip {
    position: absolute;
    left: 0;
    top: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 13px;
    white-space: nowrap;
}

/* Badge D√©part */
.itinerary-icon-trip.start-icon {
    background-color: #ffc107;
    color: #000;
    padding: 6px 14px;
    border-radius: 16px;
    font-size: 13px;
}

/* Badge Destination */
.itinerary-icon-trip.end-icon {
    background-color: #ffc107;
    color: #000;
    padding: 6px 14px;
    border-radius: 16px;
    font-size: 13px;
}

/* Num√©ros */
.itinerary-icon-trip.number-icon {
    width: 36px;
    height: 36px;
    background: #000;
    color: #fff;
    border-radius: 50%;
    font-size: 16px;
    left: 20px;
}

/* Contenu */
.itinerary-content-trip h5 {
    margin: 0 0 8px 0;
    font-size: 18px;
    color: #000;
}

.itinerary-content-trip p {
    margin: 6px 0;
    font-size: 14px;
    line-height: 1.5;
}

.stop-details {
    color: #666;
    font-size: 14px;
    margin-bottom: 10px;
}

.admission-badge {
    display: inline-block;
    margin-left: 10px;
    padding: 2px 8px;
    background-color: #e8f5e9;
    color: #2e7d32;
    border-radius: 4px;
    font-size: 12px;
}

.itinerary-link {
    color: #000;
    text-decoration: underline;
    font-size: 14px;
    cursor: pointer;
    display: inline-block;
    margin-top: 8px;
}

.itinerary-link:hover {
    color: #333;
}

/* Contenu des d√©tails cach√© par d√©faut */
.details-content {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #eee;
}

.details-content p {
    line-height: 1.6;
}

.etape-photos img {
    margin-right: 10px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
}

/* Header de la carte */
.map-header {
    position: relative;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-recenter {
    position: absolute;
    top: 60px;
    right: 10px;
    z-index: 2;
    background: white;
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.btn-recenter:hover {
    background: #f5f5f5;
}

.btn-recenter i {
    font-size: 16px;
}

/* Responsive */
@media (max-width: 992px) {
    .excursion-container {
        flex-direction: column !important;
    }
    
    .excursion-container > div {
        width: 100% !important;
    }
    
    #map {
        height: 60vh !important;
    }
}

.traveler-dropdown {
    min-width: 340px;
}

.counter button {
    width: 32px;
    height: 32px;
    border-radius: 50%;
}

.counter span {
    font-size: 1.1rem;
    min-width: 24px;
    display: inline-block;
    text-align: center;
}

.availability-section {
    background: #ffffff;
    border-radius: 12px;
}
.modern-date-input {
    background: #fff;
    border-radius: 12px;
    padding: 12px 16px;
    border: 1px solid #ddd;
    transition: all .3s;
}

.modern-date-input:focus {
    border-color: #2a3138;
    box-shadow: 0 0 10px rgba(13,110,253,0.2);
}

.traveler-icon-btn {
    background: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 16px;
    transition: .3s ease;
}

.traveler-icon-btn:hover {
    background: #eef1f4;
}

.traveler-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ff4d4d;
    color: white;
    padding: 2px 8px;
    border-radius: 50%;
    font-size: 13px;
    font-weight: bold;
}

.excursion-nav {
    display: flex;
    gap: 25px;
    padding: 15px 10px;
    border-bottom: 2px solid #e9ecef;
    position: sticky;
    top: 70px;
    background: #fff;
    z-index: 10;
}

.exc-nav-link {
    text-decoration: none;
    font-weight: 600;
    font-size: 17px;
    color: #000; /* üî• en noir */
    padding-bottom: 6px;
    cursor: pointer;
    transition: 0.3s;
    border-bottom: 3px solid transparent; /* permet soulignement propre */
}

.exc-nav-link:hover {
    color: #000;
}

.exc-nav-link.active {
    border-bottom: 3px solid #000; /* soulign√© en noir */
}

.reviews-section {
  max-width: 800px;
  margin: auto;
}

.review-card {
  background-color: #fff;
}

.review-header .review-author {
  font-size: 1.1rem;
}

.review-comment p {
  margin: 0;
}

/* Style du modal de r√©servation */
#reservationModal .modal-content {
    border: none;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 15px 50px rgba(28, 34, 40, 0.4);
}

#reservationModal .modal-header {
    background: linear-gradient(135deg, #1c2228 0%, #2a3139 100%);
    color: #ffffff;
    padding: 2rem 2.5rem;
    border-bottom: 4px solid #d8b65d;
    position: relative;
}

#reservationModal .modal-header::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 100px;
    height: 4px;
    background: #ffffff;
    box-shadow: 0 0 15px rgba(216, 182, 93, 0.6);
}

#reservationModal .modal-title {
    font-size: 1.75rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

#reservationModal .btn-close {
    filter: brightness(0) invert(1);
    opacity: 0.9;
    transition: all 0.3s ease;
    background-size: 60%;
}

#reservationModal .btn-close:hover {
    opacity: 1;
    transform: rotate(90deg);
}

#reservationModal .modal-body {
    background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
    padding: 2.5rem;
}

/* Style des groupes de formulaire */
#reservationModal .mb-3 {
    margin-bottom: 1.5rem !important;
}

/* Style des labels */
#reservationModal .form-label {
    color: #1c2228;
    font-weight: 700;
    font-size: 0.85rem;
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

#reservationModal .form-label::before {
    content: '';
    width: 4px;
    height: 16px;
    background: linear-gradient(180deg, #d8b65d 0%, #c9a84d 100%);
    border-radius: 2px;
}

/* Style moderne des inputs */
#reservationModal .form-control,
#reservationModal .form-select {
    border: 2px solid #e8e8e8;
    border-radius: 12px;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    font-weight: 500;
    color: #1c2228;
    background-color: #ffffff;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(28, 34, 40, 0.05);
}

#reservationModal .form-control::placeholder {
    color: #adb5bd;
    font-weight: 400;
    opacity: 0.7;
}

/* Effet focus - Bordure dor√©e anim√©e */
#reservationModal .form-control:focus,
#reservationModal .form-select:focus {
    border-color: #d8b65d;
    background-color: #fffef8;
    box-shadow: 0 0 0 4px rgba(216, 182, 93, 0.15), 0 4px 12px rgba(216, 182, 93, 0.2);
    outline: none;
    transform: translateY(-2px);
}

/* Effet hover */
#reservationModal .form-control:not(:focus):hover,
#reservationModal .form-select:not(:focus):hover {
    border-color: #d8b65d;
    background-color: #fafafa;
    box-shadow: 0 4px 12px rgba(28, 34, 40, 0.08);
}

/* Style sp√©cifique pour les selects */
#reservationModal .form-select {
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23d8b65d' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 12px;
    padding-right: 3rem;
}

#reservationModal .form-select:focus {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23d8b65d' d='M6 3l5 5H1z'/%3E%3C/svg%3E");
}

/* Style pour les champs num√©riques (adultes/enfants) */
#reservationModal input[type="number"] {
    text-align: center;
    font-weight: 700;
    font-size: 1.25rem;
    color: #1c2228;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
}

#reservationModal input[type="number"]::-webkit-inner-spin-button,
#reservationModal input[type="number"]::-webkit-outer-spin-button {
    opacity: 1;
    height: 40px;
    cursor: pointer;
}

/* Style pour le champ date */
#reservationModal input[type="datetime-local"] {
    cursor: pointer;
    font-weight: 600;
}

#reservationModal input[type="datetime-local"]::-webkit-calendar-picker-indicator {
    cursor: pointer;
    filter: invert(60%) sepia(50%) saturate(400%) hue-rotate(5deg);
    width: 20px;
    height: 20px;
}

/* Container pour champs c√¥te √† c√¥te */
#reservationModal .row {
    margin: 0 -0.5rem;
}

#reservationModal .row > [class*="col-"] {
    padding: 0 0.5rem;
}

/* Style du footer */
#reservationModal .modal-footer {
    background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
    padding: 2rem 2.5rem;
    border-top: 2px solid #e8e8e8;
    gap: 1rem;
}

/* Boutons stylis√©s */
#reservationModal .btn {
    padding: 1rem 2.5rem;
    font-weight: 700;
    border-radius: 30px;
    border: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-transform: uppercase;
    letter-spacing: 1.2px;
    font-size: 0.9rem;
    position: relative;
    overflow: hidden;
}

#reservationModal .btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

#reservationModal .btn:hover::before {
    width: 300px;
    height: 300px;
}

#reservationModal .btn-secondary {
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    color: #ffffff;
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

#reservationModal .btn-secondary:hover {
    background: linear-gradient(135deg, #5a6268 0%, #4e555b 100%);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
}

#reservationModal .btn-primary {
    background: linear-gradient(135deg, #d8b65d 0%, #c9a84d 100%);
    color: #1c2228;
    font-weight: 800;
    box-shadow: 0 4px 15px rgba(216, 182, 93, 0.4);
}

#reservationModal .btn-primary:hover {
    background: linear-gradient(135deg, #e5c673 0%, #d8b65d 100%);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(216, 182, 93, 0.5);
}

#reservationModal .btn-primary:active {
    transform: translateY(-1px);
}

/* Animation d'entr√©e du modal */
#reservationModal.fade .modal-dialog {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    transform: scale(0.9) translateY(-20px);
}

#reservationModal.show .modal-dialog {
    transform: scale(1) translateY(0);
}

/* Messages d'erreur stylis√©s */
#reservationModal .invalid-feedback {
    color: #dc3545;
    font-size: 0.85rem;
    font-weight: 600;
    margin-top: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: #ffe6e6;
    border-left: 4px solid #dc3545;
    border-radius: 6px;
}

#reservationModal .form-control.is-invalid,
#reservationModal .form-select.is-invalid {
    border-color: #dc3545;
    background-color: #fff5f5;
    animation: shake 0.4s;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

/* Style responsive */
@media (max-width: 768px) {
    #reservationModal .modal-body {
        padding: 1.5rem;
    }
    
    #reservationModal .modal-header {
        padding: 1.5rem;
    }
    
    #reservationModal .modal-title {
        font-size: 1.35rem;
    }
    
    #reservationModal .btn {
        padding: 0.85rem 1.75rem;
        font-size: 0.85rem;
    }
    
    #reservationModal .form-control,
    #reservationModal .form-select {
        padding: 0.85rem 1rem;
        font-size: 0.95rem;
    }
}

/* Effet de chargement pour le bouton submit */
#reservationModal .btn-primary.loading {
    pointer-events: none;
    opacity: 0.7;
}

#reservationModal .btn-primary.loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    top: 50%;
    left: 50%;
    margin-left: -8px;
    margin-top: -8px;
    border: 2px solid #1c2228;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spinner 0.6s linear infinite;
}

@keyframes spinner {
    to { transform: rotate(360deg); }
}

/* Am√©lioration visuelle pour les champs d√©sactiv√©s */
#reservationModal .form-control:disabled,
#reservationModal .form-select:disabled {
    background-color: #f0f0f0;
    border-color: #d0d0d0;
    cursor: not-allowed;
    opacity: 0.6;
}

/* Style du modal de confirmation */
#reservationConfirmation .modal-content {
    border: none;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 15px 50px rgba(28, 34, 40, 0.4);
    animation: modalBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes modalBounce {
    0% {
        transform: scale(0.3) translateY(-100px);
        opacity: 0;
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1) translateY(0);
        opacity: 1;
    }
}

/* En-t√™te avec animation de succ√®s */
#reservationConfirmation .modal-header {
    background: linear-gradient(135deg, #d8b65d 0%, #c9a84d 100%);
    color: #1c2228;
    padding: 2rem 2.5rem;
    border: none;
    position: relative;
    overflow: hidden;
}

#reservationConfirmation .modal-header::before {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: -100px;
    transform: translateY(-50%);
    font-size: 8rem;
    font-weight: bold;
    color: rgba(28, 34, 40, 0.1);
    animation: slideCheck 0.8s ease-out 0.3s forwards;
}

@keyframes slideCheck {
    to {
        left: -20px;
    }
}

#reservationConfirmation .modal-title {
    font-size: 1.75rem;
    font-weight: 800;
    letter-spacing: 1px;
    text-transform: uppercase;
    position: relative;
    z-index: 1;
    animation: fadeInUp 0.6s ease-out 0.4s both;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Ic√¥ne de succ√®s anim√©e */
#reservationConfirmation .modal-header::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    right: 2.5rem;
    transform: translateY(-50%);
    font-size: 3rem;
    font-weight: bold;
    color: #1c2228;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #ffffff;
    border-radius: 50%;
    box-shadow: 0 4px 15px rgba(28, 34, 40, 0.2);
    animation: checkPulse 1.5s ease-in-out infinite;
}

@keyframes checkPulse {
    0%, 100% {
        transform: translateY(-50%) scale(1);
        box-shadow: 0 4px 15px rgba(28, 34, 40, 0.2);
    }
    50% {
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 6px 20px rgba(28, 34, 40, 0.3);
    }
}

/* Corps du modal */
#reservationConfirmation .modal-body {
    background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
    padding: 2.5rem;
}

#reservationConfirmation .modal-body h4 {
    color: #1c2228;
    font-weight: 700;
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 2rem;
    animation: fadeInUp 0.6s ease-out 0.5s both;
    position: relative;
}

#reservationConfirmation .modal-body h4::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, transparent, #d8b65d, transparent);
    border-radius: 2px;
}

/* Carte de d√©tails */
#reservationConfirmation .card {
    border: 2px solid #e8e8e8;
    border-radius: 16px;
    background: #ffffff;
    box-shadow: 0 8px 24px rgba(28, 34, 40, 0.08);
    animation: fadeInUp 0.6s ease-out 0.6s both;
    position: relative;
    overflow: hidden;
}

#reservationConfirmation .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, #d8b65d 0%, #c9a84d 50%, #d8b65d 100%);
    background-size: 200% 100%;
    animation: shimmer 3s linear infinite;
}

@keyframes shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

#reservationConfirmation .card h5 {
    color: #1c2228;
    font-weight: 800;
    font-size: 1.25rem;
    margin-top: 1rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f0f0f0;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Style des d√©tails de r√©servation */
#reservationConfirmation .card p {
    margin-bottom: 1.25rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-radius: 10px;
    border-left: 4px solid #d8b65d;
    transition: all 0.3s ease;
    animation: slideInRight 0.5s ease-out both;
    animation-delay: calc(0.7s + var(--delay));
}

#reservationConfirmation .card p:nth-child(2) { --delay: 0s; }
#reservationConfirmation .card p:nth-child(3) { --delay: 0.1s; }
#reservationConfirmation .card p:nth-child(4) { --delay: 0.2s; }
#reservationConfirmation .card p:nth-child(5) { --delay: 0.3s; }
#reservationConfirmation .card p:nth-child(6) { --delay: 0.4s; }
#reservationConfirmation .card p:nth-child(7) { --delay: 0.5s; }

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

#reservationConfirmation .card p:hover {
    background: linear-gradient(135deg, #fffef8 0%, #f8f9fa 100%);
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(216, 182, 93, 0.15);
}

#reservationConfirmation .card p strong {
    color: #1c2228;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    display: inline-block;
    min-width: 180px;
}

/* Ic√¥nes avant les labels */
#reservationConfirmation .card p strong::before {
    content: '‚ñ∏';
    color: #d8b65d;
    font-weight: bold;
    margin-right: 0.5rem;
    font-size: 1.1rem;
}

/* Footer du modal */
#reservationConfirmation .modal-footer {
    background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
    padding: 2rem 2.5rem;
    border-top: 2px solid #e8e8e8;
    justify-content: center;
}

/* Bouton de retour stylis√© */
#reservationConfirmation .btn-primary {
    background: linear-gradient(135deg, #1c2228 0%, #2a3139 100%);
    color: #d8b65d;
    border: 3px solid #d8b65d;
    padding: 1rem 3rem;
    font-weight: 800;
    border-radius: 50px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-size: 0.95rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(28, 34, 40, 0.3);
    animation: fadeInUp 0.6s ease-out 1.3s both;
}

#reservationConfirmation .btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(216, 182, 93, 0.3), transparent);
    transition: left 0.5s ease;
}

#reservationConfirmation .btn-primary:hover::before {
    left: 100%;
}

#reservationConfirmation .btn-primary:hover {
    background: linear-gradient(135deg, #d8b65d 0%, #c9a84d 100%);
    color: #1c2228;
    border-color: #1c2228;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(216, 182, 93, 0.5);
}

#reservationConfirmation .btn-primary:active {
    transform: translateY(-1px) scale(1.02);
}

/* Animation de confettis (optionnel) */
#reservationConfirmation .modal-body::after {
    content: '‚òÖ ‚ú¶ ‚úß ‚òÖ ‚ú¶ ‚úß';
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.5rem;
    color: #d8b65d;
    opacity: 0;
    animation: confetti 2s ease-out 0.5s;
    letter-spacing: 1rem;
}

@keyframes confetti {
    0% {
        opacity: 0;
        transform: translateX(-50%) translateY(-50px) scale(0);
    }
    50% {
        opacity: 1;
        transform: translateX(-50%) translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateX(-50%) translateY(50px) scale(0.5);
    }
}

/* Responsive */
@media (max-width: 768px) {
    #reservationConfirmation .modal-header {
        padding: 1.5rem;
    }
    
    #reservationConfirmation .modal-header::after {
        width: 50px;
        height: 50px;
        font-size: 2.5rem;
        right: 1.5rem;
    }
    
    #reservationConfirmation .modal-title {
        font-size: 1.25rem;
        padding-right: 60px;
    }
    
    #reservationConfirmation .modal-body {
        padding: 1.5rem;
    }
    
    #reservationConfirmation .modal-body h4 {
        font-size: 1.25rem;
    }
    
    #reservationConfirmation .card p strong {
        min-width: 140px;
        font-size: 0.8rem;
    }
    
    #reservationConfirmation .btn-primary {
        padding: 0.85rem 2rem;
        font-size: 0.85rem;
    }
}

/* Animation de pulsation pour attirer l'attention */
@keyframes pulse {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(216, 182, 93, 0.7);
    }
    50% {
        box-shadow: 0 0 0 20px rgba(216, 182, 93, 0);
    }
}

#reservationConfirmation .btn-primary {
    animation: fadeInUp 0.6s ease-out 1.3s both, pulse 2s infinite 2s;
}

/* Bouton favoris positionn√© dans le coin sup√©rieur droit de l'image */
.favorite-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 10;
    font-size: 1.6rem;
    transition: transform 0.2s ease;
}

/* Couleur initiale du c≈ìur (vide) */
.favorite-btn i.far.fa-heart {
    color: #fff; /* blanc pour c≈ìur vide */
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
    transition: color 0.3s ease, transform 0.2s ease;
}

/* C≈ìur plein lorsque actif */
.favorite-btn i.fas.fa-heart {
    color: #d8b65d; /* couleur secondaire */
    text-shadow: 0 0 5px rgba(0,0,0,0.7);
    transform: scale(1.2);
}

/* Effet hover sur le bouton */
.favorite-btn:hover i {
    transform: scale(1.3);
    color: #d8b65d;
}

/* Animation au clic */
.favorite-btn.clicked i {
    animation: pop 0.3s ease forwards;
}

@keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.5); }
    100% { transform: scale(1.2); }
}

/* Style pour les notes en √©toiles dans le formulaire */
#formAvis .form-check {
    display: inline-block;
    margin-right: 15px;
}

#formAvis .form-check-label {
    cursor: pointer;
    padding: 8px 12px;
    border: 2px solid #dee2e6;
    border-radius: 5px;
    transition: all 0.3s;
}

#formAvis .form-check-input:checked + .form-check-label {
    background-color: #d8b65d;
    color: white;
    border-color: #d8b65d;
}

/* ========== STYLE AVIS MODERNE ========== */

.avis-section {
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(28, 34, 40, 0.1);
}

.avis-section h3 {
    color: #1c2228;
    font-weight: 700;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Bouton Donner mon avis */
.avis-section .btn-primary {
    background: linear-gradient(135deg, #d8b65d 0%, #c9a84d 100%);
    border: none;
    color: #1c2228;
    font-weight: 600;
    padding: 10px 20px;
    border-radius: 10px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(216, 182, 93, 0.2);
}

.avis-section .btn-primary:hover {
    background: linear-gradient(135deg, #c9a84d 0%, #b8973d 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(216, 182, 93, 0.3);
    color: #1c2228;
}

.avis-section .btn-primary:active {
    transform: translateY(0);
}

/* Alert Note Moyenne */
.avis-section .alert-info {
    background: linear-gradient(135deg, #f7f9fb 0%, #eef2f7 100%);
    border: 2px solid #d8b65d;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 1.5rem;
    box-shadow: 0 4px 15px rgba(216, 182, 93, 0.1);
}

.avis-section .alert-info strong {
    color: #1c2228;
    font-size: 1.1rem;
}

.avis-section .alert-info .fs-5 {
    color: #d8b65d;
    font-weight: 700;
    font-size: 1.5rem !important;
    margin: 0 5px;
}

.avis-section .alert-info .text-warning {
    font-size: 1.3rem;
}

.avis-section .alert-info .text-muted {
    color: #718096 !important;
    font-size: 0.95rem;
}

/* Liste des avis */
.avis-list {
    max-height: 600px;
    overflow-y: auto;
    padding-right: 10px;
}

.avis-list::-webkit-scrollbar {
    width: 8px;
}

.avis-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.avis-list::-webkit-scrollbar-thumb {
    background: #d8b65d;
    border-radius: 10px;
}

.avis-list::-webkit-scrollbar-thumb:hover {
    background: #c9a84d;
}

/* Carte Avis */
.avis-list .card {
    border: none !important;
    border-radius: 16px !important;
    background: #f8f9fa;
    box-shadow: 0 4px 15px rgba(28, 34, 40, 0.08) !important;
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
}

.avis-list .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(180deg, #d8b65d 0%, #c9a84d 100%);
}

.avis-list .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(216, 182, 93, 0.2) !important;
}

.avis-list .card-body {
    padding: 20px 20px 20px 25px;
}

/* En-t√™te de l'avis */
.avis-list .card-body strong {
    color: #1c2228;
    font-size: 1.05rem;
    font-weight: 600;
}

.avis-list .badge {
    background: linear-gradient(135deg, #1c2228 0%, #2a3138 100%) !important;
    color: white;
    padding: 5px 12px;
    border-radius: 8px;
    font-weight: 500;
    font-size: 0.8rem;
}

/* √âtoiles */
.avis-list .text-warning {
    font-size: 1.1rem;
    letter-spacing: 2px;
    display: flex;
    align-items: center;
    gap: 2px;
}

.avis-list .text-dark {
    color: #1c2228 !important;
    font-weight: 600;
    font-size: 0.95rem;
}

/* Commentaire */
.avis-list .card-body p {
    color: #4a5568;
    line-height: 1.7;
    margin-top: 12px;
    margin-bottom: 12px;
    padding: 12px;
    background: white;
    border-radius: 10px;
    border-left: 3px solid #d8b65d;
}

/* Date */
.avis-list .text-muted {
    color: #718096 !important;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.avis-list .text-muted i {
    color: #d8b65d;
}

/* √âtat vide */
.avis-section .alert-light {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px dashed #d8b65d;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    color: #1c2228;
    margin-top: 20px;
}

.avis-section .alert-light::before {
    content: "üí¨";
    display: block;
    font-size: 3rem;
    margin-bottom: 10px;
}

.avis-section .alert-light p {
    font-size: 1.05rem;
    margin: 0;
}

/* Responsive */
@media (max-width: 768px) {
    .avis-section {
        padding: 20px;
    }

    .avis-section h3 {
        font-size: 1.5rem;
    }

    .avis-section .d-flex {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 15px;
    }

    .avis-section .btn-primary {
        width: 100%;
        justify-content: center;
    }

    .avis-list {
        max-height: 400px;
    }

    .avis-list .card-body {
        padding: 15px 15px 15px 20px;
    }

    .avis-list .d-flex {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 10px;
    }
}

/* Animation d'apparition */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.avis-list .card {
    animation: fadeInUp 0.4s ease-out;
}
/* ========== STYLE FAQ MODERNE ========== */

.faq-section {
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(28, 34, 40, 0.1);
}

.faq-section h3 {
    color: #1c2228;
    font-weight: 700;
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    border-bottom: 3px solid #d8b65d;
    padding-bottom: 10px;
}

/* Liste des FAQ */
.faq-list {
    max-height: 600px;
    overflow-y: auto;
    padding-right: 10px;
}

.faq-list::-webkit-scrollbar {
    width: 8px;
}

.faq-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.faq-list::-webkit-scrollbar-thumb {
    background: #d8b65d;
    border-radius: 10px;
}

.faq-list::-webkit-scrollbar-thumb:hover {
    background: #c9a84d;
}

/* Carte FAQ */
.faq-item {
    background: #f8f9fa;
    border-left: 4px solid #d8b65d !important;
    border-radius: 12px !important;
    padding: 20px !important;
    margin-bottom: 1rem !important;
    box-shadow: 0 4px 15px rgba(28, 34, 40, 0.08) !important;
    transition: all 0.3s ease;
}

.faq-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(216, 182, 93, 0.2) !important;
    border-left-color: #1c2228 !important;
}

.faq-item .fw-bold {
    color: #1c2228;
    font-size: 1.1rem;
    line-height: 1.5;
    position: relative;
    padding-left: 25px;
}

.faq-item .fw-bold::before {
    content: "Q:";
    position: absolute;
    left: 0;
    color: #d8b65d;
    font-weight: 700;
}

.faq-item p:last-child {
    color: #4a5568;
    line-height: 1.7;
    padding-left: 25px;
    position: relative;
}

.faq-item p:last-child:not(em)::before {
    content: "R:";
    position: absolute;
    left: 0;
    color: #1c2228;
    font-weight: 700;
}

.faq-item em {
    color: #d8b65d;
    font-style: italic;
    display: flex;
    align-items: center;
    gap: 8px;
}

.faq-item em::before {
    content: "‚è≥";
    font-style: normal;
}

/* √âtat vide */
.faq-list .alert-light {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px dashed #d8b65d;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    color: #1c2228;
}

.faq-list .alert-light::before {
    content: "üí≠";
    display: block;
    font-size: 3rem;
    margin-bottom: 10px;
}

/* Formulaire FAQ */
.faq-section .card {
    border: none !important;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(28, 34, 40, 0.15);
}

.faq-section .card-header {
    background: linear-gradient(135deg, #1c2228 0%, #2a3138 100%) !important;
    border: none;
    padding: 20px 25px;
}

.faq-section .card-header h5 {
    color: white;
    font-weight: 600;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.faq-section .card-body {
    padding: 25px;
    background: white;
}

.faq-section .form-control {
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.faq-section .form-control:focus {
    border-color: #d8b65d;
    box-shadow: 0 0 0 3px rgba(216, 182, 93, 0.15);
    outline: none;
}

.faq-section .btn-primary {
    background: linear-gradient(135deg, #d8b65d 0%, #c9a84d 100%);
    border: none;
    color: #1c2228;
    font-weight: 600;
    padding: 12px 30px;
    border-radius: 10px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.faq-section .btn-primary:hover {
    background: linear-gradient(135deg, #c9a84d 0%, #b8973d 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(216, 182, 93, 0.3);
}

.faq-section .btn-primary:active {
    transform: translateY(0);
}

.faq-section .text-muted {
    color: #718096 !important;
    font-size: 0.9rem;
    padding: 12px;
    background: #f7fafc;
    border-radius: 8px;
    border-left: 3px solid #d8b65d;
}

.faq-section .text-muted::before {
    content: "‚ÑπÔ∏è ";
}

/* Labels du formulaire */
.faq-section label {
    color: #1c2228;
    font-weight: 600;
    margin-bottom: 8px;
}

/* Responsive */
@media (max-width: 768px) {
    .faq-section {
        padding: 20px;
    }

    .faq-section h3 {
        font-size: 1.5rem;
    }

    .faq-item {
        padding: 15px !important;
    }

    .faq-list {
        max-height: 400px;
    }
}
.card-header{
    background-color: #d8b65d;
    border: #d8b65d;
}


/* ========== STYLE MODAL AVIS PROFESSIONNEL ========== */

/* Fond du modal */
#modalAvis .modal-dialog {
    max-width: 700px;
}

#modalAvis .modal-content {
    border: none;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(28, 34, 40, 0.3);
}

/* Header du modal */
#modalAvis .modal-header {
    background: linear-gradient(135deg, #1c2228 0%, #2a3138 100%);
    color: white;
    padding: 25px 30px;
    border: none;
}

#modalAvis .modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 0;
}

#modalAvis .modal-title i {
    color: #d8b65d;
    font-size: 1.6rem;
}

#modalAvis .btn-close-white {
    filter: brightness(0) invert(1);
    opacity: 0.8;
    transition: all 0.3s ease;
}

#modalAvis .btn-close-white:hover {
    opacity: 1;
    transform: rotate(90deg);
}

/* Body du modal */
#modalAvis .modal-body {
    padding: 35px 30px;
    background: #ffffff;
}

/* Syst√®me d'√©toiles */
.star-rating {
    display: flex;
    flex-direction: row-reverse;
    justify-content: center;
    gap: 8px;
    margin-bottom: 35px;
    padding: 30px;
    background: linear-gradient(135deg, #f8f9fa 0%, #eef2f7 100%);
    border-radius: 16px;
    border: 2px solid #e9ecef;
}

.star-rating input[type="radio"] {
    display: none;
}

.star-rating label {
    cursor: pointer;
    font-size: 2.5rem;
    color: #cbd5e0;
    transition: all 0.2s ease;
    position: relative;
}

.star-rating label::before {
    content: "‚òÜ";
}

.star-rating label:hover,
.star-rating label:hover ~ label {
    color: #d8b65d;
    transform: scale(1.15);
}

.star-rating input[type="radio"]:checked ~ label {
    color: #d8b65d;
}

.star-rating input[type="radio"]:checked ~ label::before {
    content: "‚òÖ";
}

.star-rating label:hover::before,
.star-rating label:hover ~ label::before {
    content: "‚òÖ";
}

/* Animation des √©toiles */
.star-rating label:active {
    transform: scale(0.95);
}

/* Labels */
#modalAvis .form-label {
    color: #1c2228;
    font-weight: 600;
    margin-bottom: 10px;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

#modalAvis .form-label::before {
    content: "‚Ä¢";
    color: #d8b65d;
    font-size: 1.5rem;
}

/* Select */
#modalAvis .form-select {
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 1rem;
    color: #1c2228;
    transition: all 0.3s ease;
    background-color: white;
    cursor: pointer;
}

#modalAvis .form-select:focus {
    border-color: #d8b65d;
    box-shadow: 0 0 0 4px rgba(216, 182, 93, 0.15);
    outline: none;
}

#modalAvis .form-select:hover {
    border-color: #d8b65d;
}

/* Textarea */
#modalAvis .form-control {
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 14px 16px;
    font-size: 1rem;
    color: #1c2228;
    transition: all 0.3s ease;
    resize: vertical;
    min-height: 120px;
}

#modalAvis .form-control:focus {
    border-color: #d8b65d;
    box-shadow: 0 0 0 4px rgba(216, 182, 93, 0.15);
    outline: none;
}

#modalAvis .form-control::placeholder {
    color: #a0aec0;
    font-style: italic;
}

/* Footer du modal */
#modalAvis .modal-footer {
    background: #f8f9fa;
    padding: 20px 30px;
    border: none;
    gap: 12px;
}

/* Bouton Annuler */
#modalAvis .btn-secondary {
    background: white;
    border: 2px solid #e2e8f0;
    color: #1c2228;
    font-weight: 600;
    padding: 12px 28px;
    border-radius: 12px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

#modalAvis .btn-secondary:hover {
    background: #f8f9fa;
    border-color: #1c2228;
    color: #1c2228;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(28, 34, 40, 0.15);
}

#modalAvis .btn-secondary:active {
    transform: translateY(0);
}

/* Bouton Envoyer */
#modalAvis .btn-primary {
    background: linear-gradient(135deg, #d8b65d 0%, #c9a84d 100%);
    border: none;
    color: #1c2228;
    font-weight: 600;
    padding: 12px 28px;
    border-radius: 12px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(216, 182, 93, 0.3);
}

#modalAvis .btn-primary:hover {
    background: linear-gradient(135deg, #c9a84d 0%, #b8973d 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(216, 182, 93, 0.4);
    color: #1c2228;
}

#modalAvis .btn-primary:active {
    transform: translateY(0);
}

/* Ic√¥nes des boutons */
#modalAvis .modal-footer button i {
    font-size: 1.1rem;
}

/* S√©parateurs visuels entre sections */
#modalAvis .mb-4 {
    padding-bottom: 20px;
    border-bottom: 1px solid #e9ecef;
}

/* Animation d'ouverture du modal */
#modalAvis.fade .modal-dialog {
    transform: scale(0.95);
    transition: transform 0.3s ease-out;
}

#modalAvis.show .modal-dialog {
    transform: scale(1);
}

/* Message d'aide pour les √©toiles */
.star-rating::after {
    content: "Cliquez pour noter";
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    color: #718096;
    font-size: 0.85rem;
    font-style: italic;
    white-space: nowrap;
}

.star-rating {
    position: relative;
    margin-bottom: 50px;
}

/* Responsive */
@media (max-width: 768px) {
    #modalAvis .modal-dialog {
        margin: 10px;
    }

    #modalAvis .modal-header {
        padding: 20px;
    }

    #modalAvis .modal-title {
        font-size: 1.2rem;
    }

    #modalAvis .modal-body {
        padding: 25px 20px;
    }

    #modalAvis .modal-footer {
        padding: 15px 20px;
        flex-direction: column;
    }

    #modalAvis .modal-footer button {
        width: 100%;
        justify-content: center;
    }

    .star-rating label {
        font-size: 2rem;
    }

    .star-rating {
        padding: 20px;
        gap: 5px;
    }
}

/* Animation de focus sur les √©l√©ments du formulaire */
@keyframes pulse {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(216, 182, 93, 0.4);
    }
    50% {
        box-shadow: 0 0 0 4px rgba(216, 182, 93, 0.1);
    }
}

#modalAvis .form-control:focus,
#modalAvis .form-select:focus {
    animation: pulse 2s ease-in-out;
}

#avis_excursion_note{
    display: none !important;
}

#chat-widget {
    display:none;
    position:fixed;
    right:20px;
    bottom:20px;
    width:320px;
    max-width:90%;
    background:#fff;
    border-radius:10px;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
    z-index:1050;
    font-family:Arial,sans-serif;
    overflow:hidden;
    flex-direction:column;
}
.chat-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#075E54;
    color:#fff;
    padding:10px;
    font-weight:bold;
}
#close-chat {
    background:none;
    border:none;
    color:#fff;
    font-size:1rem;
    cursor:pointer;
}
#chat-messages {
    height:240px;
    overflow-y:auto;
    padding:10px;
    background:#ece5dd;
}
.chat-footer {
    display:flex;
    border-top:1px solid #ccc;
}
#chat-input {
    flex:1;
    border:none;
    padding:10px;
}
#send-btn {
    background:#25D366;
    color:#fff;
    border:none;
    padding:0 15px;
    cursor:pointer;
}
.message-user {
    background:#dcf8c6;
    padding:5px 10px;
    border-radius:10px;
    margin-bottom:5px;
    max-width:80%;
    align-self:flex-end;
}
.message-admin {
    background:#fff;
    padding:5px 10px;
    border-radius:10px;
    margin-bottom:5px;
    max-width:80%;
    align-self:flex-start;
}
.info-box-modern .icon-circle {
    background-color: #d8b65d; /* fond du cercle */
    color: #2a3138; /* ic√¥ne en blanc */
}
.btn-animated {
    position: relative;
    display: inline-block;
    border: none;
    border-radius: 27px;
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    padding: 12px 30px;
    cursor: pointer;
    overflow: hidden;
    background: linear-gradient(270deg, #2a3138, #d8b65d, #2a3138);
    background-size: 600% 600%;
    animation: gradientMove 5s ease infinite;
    transition: color 0.3s;
}

@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
/* Bouton anim√© primaire (Confirmer) */
.btn-animated-primary {
    position: relative;
    display: inline-block;
    border: none;
    border-radius: 27px;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    padding: 10px 25px;
    cursor: pointer;
    overflow: hidden;
    background: linear-gradient(270deg, #2a3138, #d8b65d, #2a3138);
    background-size: 600% 600%;
    animation: gradientMove 5s ease infinite;
    transition: color 0.3s;
}

/* Bouton anim√© secondaire (Annuler) */
.btn-animated-secondary {
    position: relative;
    display: inline-block;
    border: none;
    border-radius: 27px;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    padding: 10px 25px;
    cursor: pointer;
    overflow: hidden;
    background: linear-gradient(270deg, #6c757d, #495057, #6c757d); /* gris fonc√© anim√© */
    background-size: 600% 600%;
    animation: gradientMove 5s ease infinite;
    transition: color 0.3s;
}

/* Animation gradient partag√© */
@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}


</style>
{% endblock %}



{% block body %}

<!-- HERO SECTION -->
<div class="home">
    <div class="home_content">
        <div class="home_title">{{ excursion.titre }}</div>
        <p>Liste des excursions // Details</p>
    </div>
</div>


<div class="container my-5">

        <div class="row gx-4">

            <!-- LEFT COLUMN -->
            <div class="col-lg-8">

                {# ================= CAROUSEL ================= #}
                {% if excursion.images|length > 0 %}
                    <div id="galleryCarousel" class="carousel slide carousel-fade mb-4" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            {% for img in excursion.images %}
                                <div class="carousel-item {% if loop.first %}active{% endif %}">
                                    <img src="{{ asset('uploads/images/' ~ img.imageUrl) }}" 
                                        class="d-block w-100 zoomable-image"
                                        data-index="{{ loop.index0 }}">
                                </div>
                            {% endfor %}
                        </div>

                        <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>

                {% endif %}

                {# ================= MODAL FULLSCREEN ================= #}
                <div class="modal fade" id="imageModal" tabindex="-1">
                    <div class="modal-dialog modal-fullscreen">
                        <div class="modal-content bg-dark">
                            <div class="modal-body d-flex justify-content-center align-items-center position-relative">

                                <!-- Bouton fermer -->
                                <button class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"></button>

                                <!-- Image -->
                                <img id="modalImage" src="" class="img-fluid">

                                <!-- Fl√®che Gauche -->
                                <button id="prevImage" class="btn text-white position-absolute start-0 top-50 fs-1">
                                    ‚Äπ
                                </button>

                                <!-- Fl√®che Droite -->
                                <button id="nextImage" class="btn text-white position-absolute end-0 top-50 fs-1">
                                    ‚Ä∫
                                </button>

                            </div>
                        </div>
                    </div>
                </div>

                {# ================= NAVBAR INTERNE ================= #}
                <div class="excursion-nav mb-4">
                    <a href="javascript:void(0)" class="exc-nav-link active" data-target="#section-description">Description</a>
                    <a href="javascript:void(0)" class="exc-nav-link" data-target="#section-details">D√©tails</a>
                    <a href="javascript:void(0)" class="exc-nav-link" data-target="#section-itineraire">Itin√©raire</a>
                </div>

                {# ================= DESCRIPTION ================= #}
                <h3 class="section-title" id="section-description">Description</h3>

                <div class="description-container mb-3">
                    <p class="description" id="description-{{ excursion.id }}">
                        {{ excursion.description|nl2br|raw }}
                    </p>
                    <a href="javascript:void(0);" class="toggle-description" 
                    data-target="description-{{ excursion.id }}">...Plus</a>
                </div>

                {# ================= TABLEAU D√âTAILS ================= #}
                <table class="table table-bordered align-middle shadow-sm">
                    <tbody>
                        <tr>
                            <th class="bg-light w-25"><i class="bi bi-clock text-primary me-2 text-dark"></i>Dur√©e</th>
                            <td><strong>{{ excursion.duree }} jours</strong></td>
                        </tr>

                        <tr>
                            <th class="bg-light"><i class="bi bi-tag text-primary me-2 text-dark"></i>Cat√©gorie</th>
                            <td><strong>{{ excursion.categorie }}</strong></td>
                        </tr>

                        <tr>
                            <th class="bg-light"><i class="bi bi-geo-alt text-primary me-2 text-dark"></i>Localisation</th>
                            <td><strong>{{ excursion.localisation }}</strong></td>
                        </tr>

                        <tr>
                            <th class="bg-light"><i class="bi bi-people text-primary me-2 text-dark"></i>√Çges</th>
                            <td><strong>{{ excursion.ages }}</strong></td>
                        </tr>

                        <tr>
                            <th class="bg-light"><i class="bi bi-person-badge text-primary me-2 text-dark"></i>Max personnes</th>
                            <td><strong>{{ excursion.maxPers }}</strong></td>
                        </tr>

                        <tr>
                            <th class="bg-light"><i class="bi bi-book text-primary me-2 text-dark"></i>Guide</th>
                            <td><strong>{{ excursion.guide }}</strong></td>
                        </tr>
                    </tbody>
                </table>

            </div> <!-- FIN LEFT COLUMN -->

            <!-- RIGHT COLUMN : SIDEBAR -->
            <div class="col-lg-4 sticky-sidebar">

                {# ================= BLOC INFORMATIONS ================= #}
                <div class="info-box-modern mb-4 p-4 shadow-sm">
                    <h3 class="mb-4 fw-bold">Informations</h3>
                            {# Bouton favoris #}
                            <button class="favorite-btn require-login" 
                                    data-excursion-id="{{ excursion.id }}" 
                                    data-action="add-favoris">
                                <i class="far fa-heart {% if excursion.id in userFavorisIds %}fas text-warning{% endif %}"></i>
                            </button>
                    <!-- Prix -->
                    <div class="d-flex align-items-start mb-4">
                        <div class="icon-circle me-3">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div>
                            <strong class="fs-5">√Ä partir de {{ excursion.prixParPersonne }} TND</strong><br>
                            <small class="text-muted">par adulte (prix variable selon le groupe)</small><br>
                            <a href="#" data-bs-toggle="modal" data-bs-target="#modalPrix" class="link-modern">
                                Garantie Prix le Plus Bas
                            </a>
                        </div>
                    </div>

                    <!-- R√©servez maintenant / Payez plus tard -->
                    <div class="d-flex align-items-start mb-4">
                        <div class="icon-circle me-3">
                            <i class="bi bi-arrow-repeat"></i>
                        </div>
                        <div>
                            <a href="#" data-bs-toggle="modal" data-bs-target="#modalReserver"
                            class="link-modern fw-semibold">R√©servez maintenant et payez plus tard</a>
                            <ul class="mt-1">
                                <li>Garantissez votre place tout en restant flexible.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Annulation gratuite -->
                    {% if excursion.cancellation %}
                        <div class="d-flex align-items-start mb-4">
                            <div class="icon-circle me-3">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            <div>
                                <a href="#" data-bs-toggle="modal" data-bs-target="#modalCancellation"
                                class="link-modern fw-semibold">Annulation gratuite</a>
                                <ul class="mt-1">
                                    <li>{{ excursion.cancellation }}</li>
                                </ul>
                            </div>
                        </div>
                    {% endif %}

                    <!-- BOUTON : OUVRIR MODAL -->
                    <div class="col-md-auto">
                        <button class="btn btn-animated btn-lg px-4" data-bs-toggle="modal" data-bs-target="#reservationModal">
                            R√©server maintenant
                        </button>
                    </div>

                </div>

                {# ================= BLOC QUESTIONS ================= #}
                <div class="info-box-modern mb-4 p-4 shadow-sm">
                    <h3 class="mb-3 fw-bold">Des questions ?</h3>

                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-circle me-3">
                            <i class="bi bi-telephone-forward-fill"></i>
                        </div>
                        <strong class="fs-5">+216 93 313 278</strong>
                    </div>

                    <!-- Bouton ouverture chat -->
                    <div class="d-flex align-items-center">
                        <div class="icon-circle me-3">
                            <i class="bi bi-chat-right-dots-fill"></i>
                        </div>
                        <a href="#" id="open-chat" class="link-modern">Ouvrir le chat</a>
                    </div>
                </div>

                

                <!-- Fen√™tre chat -->
                <div id="chat-widget">
                    <div class="chat-header">
                        <div>
                            <strong>Support</strong>
                            <div style="font-size:0.8rem;">Contact admin via WhatsApp</div>
                        </div>
                        <button id="close-chat">‚úï</button>
                    </div>
                    <div id="chat-messages">
                        <div class="text-muted small">Bonjour ! √âcris ton message et appuie sur Envoyer.</div>
                    </div>
                    <div class="chat-footer">
                        <input type="text" id="chat-input" placeholder="√âcris ton message..." maxlength="1000">
                        <button id="send-btn">Envoyer</button>
                    </div>
                </div>
            </div> <!-- FIN RIGHT COLUMN -->

        </div> <!-- FIN ROW -->
    
        <!-- ACCORDION D√âTAILS DE L‚ÄôEXCURSION -->
        <div class="col-lg-8 accordion mt-4" id="section-details-excursion">

            {% if excursion.inclusList|length > 0 %}
                <div class="accordion-item" id="section-details">
                    <h2 class="accordion-header" id="headingInclus">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInclus">
                            ‚úîÔ∏è Ce qui est inclus
                        </button>
                    </h2>
                    <div id="collapseInclus" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <ul>
                                {% for item in excursion.inclusList %}
                                    <li>{{ item.item }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if excursion.nonInclusList|length > 0 %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingNonInclus">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNonInclus">
                            ‚ùå Ce qui n'est pas inclus
                        </button>
                    </h2>
                    <div id="collapseNonInclus" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <ul>
                                {% for item in excursion.nonInclusList %}
                                    <li>{{ item.item }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- D√©tails de l'excursion tri√©s par ordre -->
            {% if excursion.details|length > 0 %}
                {% set sortedDetails = excursion.details|sort((a, b) => a.ordre <=> b.ordre) %}

                {% set detailsAffiches = 0 %}

                {% for detail in sortedDetails %}
                    {% if detail.titre|trim is not empty and detail.description|trim is not empty %}
                        {% set detailsAffiches = detailsAffiches + 1 %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingDetail{{ detail.id }}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetail{{ detail.id }}">
                                    ‚Ä¢ {{ detail.titre }}
                                </button>
                            </h2>
                            <div id="collapseDetail{{ detail.id }}" class="accordion-collapse collapse">
                                <div class="accordion-body" style="line-height: 2;">
                                    {{ detail.description|nl2br|raw }}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}

                {% if detailsAffiches == 0 %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingDetailEmpty">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetailEmpty">
                                ‚Ä¢ D√©tails de l'excursion
                            </button>
                        </h2>
                        <div id="collapseDetailEmpty" class="accordion-collapse collapse show">
                            <div class="accordion-body">
                                <p class="text-muted">Aucun d√©tail disponible.</p>
                            </div>
                        </div>
                    </div>
                {% endif %}

            {% else %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingDetailEmpty">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetailEmpty">
                            ‚Ä¢ D√©tails de l'excursion
                        </button>
                    </h2>
                    <div id="collapseDetailEmpty" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <p class="text-muted">Aucun d√©tail disponible.</p>
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if excursion.aPropos|length > 0 %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingApropos">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseApropos">
                            ‚Ä¢ √Ä Quoi s'attendre
                        </button>
                    </h2>
                    <div id="collapseApropos" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            {{ excursion.aPropos|nl2br|raw }}
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>


        

<!-- MODAL DE RESERVATION -->
<div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="reservationModalLabel">R√©server votre excursion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>

            {{ form_start(reservationForm) }}

            <div class="modal-body">

                <div class="row g-4">

                    <!-- Nom -->
                    <div class="col-md-6">
                        <label class="form-label fw-bold">{{ form_label(reservationForm.nom) }}</label>
                        {{ form_widget(reservationForm.nom, {
                            'attr': {'class': 'form-control form-control-lg'}
                        }) }}
                        {{ form_errors(reservationForm.nom) }}
                    </div>

                    <!-- Pr√©nom -->
                    <div class="col-md-6">
                        <label class="form-label fw-bold">{{ form_label(reservationForm.prenom) }}</label>
                        {{ form_widget(reservationForm.prenom, {
                            'attr': {'class': 'form-control form-control-lg'}
                        }) }}
                        {{ form_errors(reservationForm.prenom) }}
                    </div>

                    <!-- Adultes -->
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Adultes</label>
                        {{ form_widget(reservationForm.adult, {
                            'attr': {'class': 'form-control form-control-lg'}
                        }) }}
                        {{ form_errors(reservationForm.adult) }}
                    </div>

                    <!-- Enfants -->
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Enfants</label>
                        {{ form_widget(reservationForm.child, {
                            'attr': {'class': 'form-control form-control-lg'}
                        }) }}
                        {{ form_errors(reservationForm.child) }}

                        <div class="form-text text-second fw-bold mt-1">
                            Vous avez une remise de 20% pour les enfants üéâ
                        </div>
                    </div>
                    <!-- Date & Heure -->
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Date & Heure</label>
                        {{ form_widget(reservationForm.dateHeure, {
                            'attr': {'class': 'form-control form-control-lg'}
                        }) }}
                        {{ form_errors(reservationForm.dateHeure) }}
                    </div>

                    <!-- Point de prise en charge -->
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Point de prise en charge</label>
                        {{ form_widget(reservationForm.localisationPoint, {
                            'attr': {'class': 'form-control form-control-lg', 'placeholder': 'ex: Devant h√¥tel Golden Tulip'}
                        }) }}
                        {{ form_errors(reservationForm.localisationPoint) }}
                    </div>

                    <!-- Champ excursion cach√© -->
                    {{ form_widget(reservationForm.excursion) }}

                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-animated-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="submit" class="btn btn-animated-primary">Confirmer la r√©servation</button>
            </div>


            {{ form_end(reservationForm) }}

        </div>
    </div>
</div>

<!-- MODAL CONFIRMATION -->
<div class="modal fade" id="reservationConfirmation" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">R√©servation confirm√©e</h5>
            </div>

            <div class="modal-body">

                <h4 class="mb-3">Merci pour votre r√©servation !</h4>

                <div class="card p-3 shadow-sm">
                    <h5 class="fw-bold mb-3">D√©tails de la r√©servation</h5>

                    <p><strong>Excursion :</strong> {{ reservation.excursion.titre }}</p>
                    <p><strong>Nom :</strong> {{ reservation.nom }} {{ reservation.prenom }}</p>
                    <p><strong>Adultes :</strong> {{ reservation.adult }}</p>
                    <p><strong>Enfants :</strong> {{ reservation.child }}</p>
                    <p><strong>Date & Heure :</strong> {{ reservation.dateHeure|date('d/m/Y H:i') }}</p>
                    <p><strong>Point de prise en charge :</strong> {{ reservation.localisationPoint }}</p>
                    <p><strong>Prix total :</strong> {{ reservation.prixTotal }} TND</p>


                    
                </div>

            </div>

            <div class="modal-footer">
                <a href="{{ path('app_front_excursions_list') }}" class="btn btn-primary">Retour aux excursions</a>
            </div>

        </div>
    </div>
</div>



            <!-- DEUXI√àME ROW : Contenu full-width (Accordion + Itin√©raire + Map) -->
            <div class="row mt-4">
                <div class="col-12">

                    <!-- Itin√©raire + Map -->
                    <div class="excursion-container" 
                        style="display:flex; gap:20px; margin-top:30px; flex-wrap: wrap;">

                        <!-- LEFT : Itin√©raire styl√© TripAdvisor -->
                        <div style="flex: 1 1 40%; max-height:80vh; overflow-y:auto; padding-right:10px; min-width: 300px;">
                            <h2 class="section-title" id="section-itineraire">Itin√©raire</h2>

                            <div class="itinerary-container-tripadvisor">

                                <!-- Point de D√©part -->
                                <div class="itinerary-step-trip">
                                    <div class="itinerary-icon-trip start-icon">D√©part</div>
                                    <div class="itinerary-content-trip">
                                        <h5 class="fw-bold">On passera vous prendre</h5>
                                        
                                    </div>
                                </div>

                                {% set steps = excursion.itineraires|sort((a,b) => a.ordre <=> b.ordre) %}
                                {% for etape in steps %}
                                    {% set lat = etape.coordinates ? etape.coordinates|split(',')[0] : '' %}
                                    {% set lng = etape.coordinates ? etape.coordinates|split(',')[1] : '' %}

                                    <!-- √âtape de l'itin√©raire -->
                                    <div class="itinerary-step-trip etape-box"
                                        data-lat="{{ lat }}"
                                        data-lng="{{ lng }}">

                                        <div class="itinerary-icon-trip number-icon">{{ loop.index }}</div>

                                        <div class="itinerary-content-trip">
                                            <h5 class="fw-bold">{{ etape.titreEtape }}</h5>
                                            <p class="stop-details">
                                                {% if etape.dureeVisite %} Arr√™t : {{ etape.dureeVisite }} {% endif %}
                                                {% if etape.admission %} 
                                                    <span class="admission-badge">{{ etape.admission }}</span> 
                                                {% endif %}
                                            </p>

                                            <!-- Lien pour afficher les d√©tails -->
                                            <a href="javascript:void(0);" 
                                            class="itinerary-link toggle-details" 
                                            data-target="details-{{ loop.index }}">
                                                {% if etape.hasPhotos %} Voir les d√©tails et les photos {% else %} Voir les d√©tails {% endif %}
                                            </a>

                                            <!-- Contenu cach√© (description + photos) -->
                                            <div class="details-content" id="details-{{ loop.index }}" style="display: none;">
                                                <p class="text-muted mt-3">{{ etape.descriptionEtape }}</p>

                                                {% if etape.photos|length > 0 %}
                                                    <div class="etape-photos mt-3">
                                                        <div class="row g-2">
                                                            {% for photo in etape.photos %}
                                                                <div class="col-6">
                                                                    <img src="{{ asset('uploads/itineraire_photos/' ~ photo.imageUrl) }}" 
                                                                        class="img-fluid rounded" 
                                                                        alt="{{ photo.legende }}"
                                                                        style="width: 100%; height: 150px; object-fit: cover; cursor: pointer;"
                                                                        onclick="openPhotoModal('{{ asset('uploads/itineraire_photos/' ~ photo.imageUrl) }}', '{{ photo.legende }}')">
                                                                    {% if photo.legende %}
                                                                        <small class="text-muted d-block mt-1">{{ photo.legende }}</small>
                                                                    {% endif %}
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                {% endif %}

                                                <a href="javascript:void(0);" 
                                                class="itinerary-link toggle-details mt-2" 
                                                data-target="details-{{ loop.index }}">
                                                    Voir moins
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}


                                <!-- Point de Retour -->
                                <div class="itinerary-step-trip">
                                    <div class="itinerary-icon-trip end-icon">Destination</div>
                                    <div class="itinerary-content-trip">
                                        <h5 class="fw-bold">Retournerez au point de d√©part</h5>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- RIGHT : MAP -->
                        <div style="flex: 1 1 55%; min-width: 300px;">
                            <div class="map-header">
                                <button class="btn-recenter" onclick="recenterMap()">
                                    <i class="bi bi-crosshair"></i> Recentrer l'itin√©raire
                                </button>
                            </div>
                            <div id="map" style="height:75vh; width:100%; border-radius:10px;"></div>
                        </div>

                    </div> <!-- fin Itin√©raire + Map -->

                </div>
            </div> <!-- fin row full-width -->


        <!-- MODALS -->

        <!-- Modal Annulation -->
        <div class="modal fade" id="modalCancellation" tabindex="-1" aria-labelledby="modalCancellationLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalCancellationLabel">Conditions d'annulation</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Pour recevoir un remboursement complet, vous devez annuler plus de 24 heures avant l'heure de d√©but de l'exp√©rience.</p>
                        <ul style="padding-left: 20px; list-style: disc !important;">
                            <li>Si vous annulez moins de 24 heures avant l'heure de d√©but de l'exp√©rience, le montant que vous avez pay√© ne sera pas rembours√©.</li>
                            <li>Aucune modification effectu√©e moins de 24 heures avant l'heure de d√©but de l'exp√©rience ne sera accept√©e.</li>
                            <li>Les heures limites de r√©servation sont bas√©es sur le fuseau horaire de l'exp√©rience.</li>
                            <li>Cette exp√©rience n√©cessite des conditions m√©t√©o cl√©mentes. Si elle est annul√©e en raison du mauvais temps, nous vous proposerons une autre date ou le remboursement complet.</li>
                            <li>Pour avoir lieu, cette exp√©rience requiert un nombre minimum de voyageurs. Si elle est annul√©e car cette condition n'est pas remplie, nous vous proposerons une autre date/activit√© ou le remboursement complet.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal R√©servez maintenant et payez plus tard -->
        <div class="modal fade" id="modalReserver" tabindex="-1" aria-labelledby="modalReserverLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-xl">
                <div class="modal-content" style="border-radius: 16px; padding: 10px 20px;">
                    <div class="modal-header border-0">
                        <h3 class="modal-title fw-bold" style="color:#0b3d2e;" id="modalReserverLabel">R√©servez maintenant et payez plus tard</h3>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body pb-4">
                        <p class="mb-4" style="font-size:17px;">
                            Nous r√©servons votre place aujourd'hui et vous pouvez annuler jusqu'√† deux jours* avant 
                            le d√©but de votre exp√©rience sans effectuer de paiement. 
                            Garantissez votre place facilement, restez flexible et ne manquez rien.
                        </p>

                        <!-- HOW IT WORKS -->
                        <div class="row gy-4">
                            {% for i, step in 0..4 %}
                                {% if i > 0 %}
                                    <div class="col-12 d-flex">
                                        <div class="me-3 d-flex align-items-start justify-content-center"
                                            style="width:42px;height:42px;border:2px solid #0b3d2e;border-radius:50%;font-weight:bold;font-size:18px;display:flex;align-items:center;justify-content:center;">
                                            {{ i }}
                                        </div>
                                        <div>
                                            {% if i == 1 %}
                                                <h5 class="fw-bold mb-1">Trouvez votre exp√©rience</h5>
                                                <p class="mb-0">Choisissez l'exp√©rience que vous voulez en sachant que votre place est acquise, sans vous bloquer pour autant.</p>
                                            {% elseif i == 2 %}
                                                <h5 class="fw-bold mb-1">Faire une r√©servation</h5>
                                                <p class="mb-0">R√©servez maintenant et payez plus tard pour garantir votre place, c'est sans engagement.</p>
                                            {% elseif i == 3 %}
                                                <h5 class="fw-bold mb-1">Choisissez quand payer</h5>
                                                <p class="mb-0">Revenez payer quand vos projets sont fix√©s, ou laissez le paiement automatique fonctionner deux jours* avant votre exp√©rience.</p>
                                            {% elseif i == 4 %}
                                                <h5 class="fw-bold mb-1">Profitez de votre exp√©rience</h5>
                                                <p class="mb-0">Vous avez termin√© ! Amusez-vous bien.</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <p class="mt-3" style="font-size:14px; color:#555;">
                            * Jusqu'√† neuf jours en fonction de la r√©servation ou du produit.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Garantie Prix le Plus Bas -->
        <div class="modal fade" id="modalPrix" tabindex="-1" aria-labelledby="modalPrixLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content" style="border-radius: 12px;">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold" id="modalPrixLabel">Garantie Prix le Plus Bas</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Nous garantissons les prix les plus bas sur les plus de 400 000 exp√©riences disponibles
                            √† la r√©servation sur notre site. Si vous trouvez le m√™me produit moins cher en ligne jusqu'√†
                            48 heures apr√®s le d√©but de votre exp√©rience, nous vous remboursons la diff√©rence.
                        </p>

                        <h6 class="fw-bold mt-4">Rien de plus simple :</h6>

                        {% for i in 1..4 %}
                        <div class="d-flex mb-3">
                            <div class="rounded-circle border border-dark d-flex justify-content-center align-items-center"
                                style="width: 35px; height: 35px; font-weight: bold;">{{ i }}</div>
                            <div class="ms-3">
                                {% if i == 1 %}
                                    <strong>Rassemblez vos informations</strong><br>
                                    Pr√©sentez votre r√©f√©rence de r√©servation ou votre r√©f√©rence d'itin√©raire et un justificatif
                                    du prix inf√©rieur que vous avez trouv√©.
                                {% elseif i == 2 %}
                                    <strong>Envoyez-nous les informations</strong><br>
                                    Envoyez vos documents, votre nom et votre adresse postale par e-mail √†
                                    <a href="TuniTripSupport@gmail.com">TuniTripSupport@gmail.com</a>.
                                {% elseif i == 3 %}
                                    <strong>Nous passerons en revue</strong><br>
                                    Nous analyserons vos documents et nous vous recontacterons d√®s que possible.
                                {% elseif i == 4 %}
                                    <strong>Recevez votre remboursement</strong><br>
                                    Si les informations sont confirm√©es, nous vous rembourserons la diff√©rence de prix.
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}

                    </div>
                </div>
            </div>
        </div>


        <div class="container mt-5">
            <div class="row">
                
                <!-- ========== COLONNE GAUCHE : AVIS ========== -->
                <div class="col-lg-6">
                    <section class="avis-section">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="mb-0">‚≠ê Avis des utilisateurs</h3>
                            {% if app.user %}
                                <button type="button" class="btn btn-animated-primary" id="btnAvis">
                                    <i class="bi bi-plus-circle"></i> Donner mon avis
                                </button>

                            {% endif %}

                        </div>

                        {% if noteMoyenne > 0 %}
                            <div class="alert alert-info mb-3">
                                <strong>Note moyenne :</strong> 
                                <span class="fs-5">{{ noteMoyenne|number_format(1) }}/5</span>
                                <span class="text-warning">‚≠ê</span>
                                <small class="text-muted">({{ avis|length }} avis)</small>
                            </div>
                        {% endif %}
                        {% if not app.user %}
                            <small class="text-danger d-block mb-3">
                                ‚ö†Ô∏è Vous devez √™tre connect√© pour donner un avis.
                            </small>
                        {% endif %}


                        {% if avis is not empty %}
                            <div class="avis-list" style="max-height: 600px; overflow-y: auto;">
                                {% for a in avis %}
                                    <div class="card mb-3 shadow-sm">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div>
                                                    <strong>{{ a.user.email }}</strong>
                                                    {% if a.compagnon %}
                                                        <span class="badge bg-secondary ms-2">{{ a.compagnon }}</span>
                                                    {% endif %}
                                                </div>
                                                <div class="text-warning">
                                                    {% for i in 1..5 %}
                                                        {% if i <= a.note %}
                                                            ‚≠ê
                                                        {% else %}
                                                            ‚òÜ
                                                        {% endif %}
                                                    {% endfor %}
                                                    <span class="text-dark ms-1">{{ a.note }}/5</span>
                                                </div>
                                            </div>

                                            {% if a.commentaire %}
                                                <p class="mt-2 mb-2">{{ a.commentaire }}</p>
                                            {% endif %}

                                            <small class="text-muted">
                                                <i class="bi bi-clock"></i> {{ a.createdAt|date('d/m/Y √† H:i') }}
                                            </small>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="alert alert-light text-center">
                                <p class="mb-0">Aucun avis pour le moment. Soyez le premier √† donner votre avis !</p>
                            </div>
                        {% endif %}
                    </section>
                </div>

                <!-- ========== COLONNE DROITE : FAQ ========== -->
                <div class="col-lg-6">
                    <section class="faq-section">
                        <h3 class="mb-3">‚ùì Questions fr√©quentes</h3>
                         {% if not app.user %}
                            <small class="text-danger d-block mb-3">
                                ‚ö†Ô∏è Vous devez √™tre connect√© pour poser des questions.
                            </small>
                        {% endif %}

                        <div class="faq-list" style="max-height: 600px; overflow-y: auto;">
                            {% if faqs is not empty %}
                                {% for faq in faqs|reverse %}
                                    <div class="faq-item mb-3 p-3 border rounded shadow-sm">
                                        <p class="fw-bold mb-1">{{ faq.question }}</p>
                                        <p class="mb-0">
                                            {% if faq.reponse %}
                                                {{ faq.reponse|nl2br }}
                                            {% else %}
                                                <em>En attente de r√©ponse de l'administrateur...</em>
                                            {% endif %}
                                        </p>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="alert alert-light text-center">
                                    <p class="mb-0">Aucune question pour le moment.</p>
                                </div>
                            {% endif %}
                        </div>

                        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                            <!-- FORMULAIRE POUR POSER UNE QUESTION -->
                            <div class="card mt-4 ">
                                <div class="card-header text-white">
                                    <h5 class="mb-0">üí¨ Poser une question</h5>
                                </div>
                                <div class="card-body">
                                    {{ form_start(faqForm, {'attr': {'id': 'faqForm'}}) }}
                                        {{ form_row(faqForm.question, {
                                            'attr': {'class': 'form-control', 'rows': 3}
                                        }) }}
                                        <button type="submit" class="btn btn-animated-primary mt-2">
                                            <i class="bi bi-send"></i> Envoyer la question
                                        </button>

                                    {{ form_end(faqForm) }}
                                    <small class="text-muted d-block mt-2">
                                        Votre question sera visible apr√®s qu'un administrateur y r√©ponde.
                                    </small>
                                </div>
                            </div>
                     
                           
                           
                        {% endif %}

                    </section>
                </div>

            </div>
        </div>

        <!-- ========== MODAL AVIS ========== -->
        <div class="modal fade" id="modalAvis" tabindex="-1" aria-labelledby="modalAvisLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header ">
                        <h5 class="modal-title" id="modalAvisLabel">
                            <i class="bi bi-star-fill"></i> Donner mon avis sur l'excursion
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    {{ form_start(avisForm, {'attr': {'id': 'formAvis'}}) }}
                    <div class="modal-body">
                        
                    
                        <div class="mb-4">
                            <label class="form-label fw-bold">Avec qui avez-vous voyag√© ? *</label>
                            {{ form_widget(avisForm.compagnon, {
                                'attr': {'class': 'form-select'}
                            }) }}
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Votre commentaire</label>
                            {{ form_widget(avisForm.commentaire, {
                                'attr': {
                                    'class': 'form-control',
                                    'rows': 5,
                                    'placeholder': 'Partagez votre exp√©rience...'
                                }
                            }) }}
                        </div>

                        <div class="star-rating">
                            {% for i in 5..1 %}
                                <input type="radio" id="note{{ i }}" name="{{ avisForm.note.vars.full_name }}" value="{{ i }}">
                                <label for="note{{ i }}"></label>
                            {% endfor %}
                        </div>


                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-animated-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle"></i> Annuler
                        </button>
                        <button type="submit" class="btn btn-animated-primary">
                            <i class="bi bi-send-fill"></i> Envoyer mon avis
                        </button>
                    </div>

                    {{ form_end(avisForm) }}

                </div>
            </div>
        </div>

</div>

<!-- Leaflet Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
{% endblock %}



{% block script %}

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Toggle description -->
    <script>
        document.querySelectorAll('.toggle-description').forEach(link => {
            link.addEventListener('click', function () {
                const targetId = this.dataset.target;
                const desc = document.getElementById(targetId);

                if (desc.classList.contains('expanded')) {
                    desc.classList.remove('expanded');
                    this.textContent = '...Plus';
                } else {
                    desc.classList.add('expanded');
                    this.textContent = 'Moins d\'info';
                }
            });
        });
    </script>

    <!-- Map + markers -->
    <script>
        // Initialize map
        let map = L.map('map').setView([34.0, 9.0], 7);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        let markers = [];

        // Add markers for steps
        document.querySelectorAll('.etape-box').forEach((box, index) => {
            let lat = box.dataset.lat;
            let lng = box.dataset.lng;

            if (lat && lng) {
                let icon = L.divIcon({
                    className: 'custom-number-icon',
                    html: `
                        <div style="
                            background:#000; color:#fff; width:28px; height:28px;
                            border-radius:50%; display:flex; align-items:center;
                            justify-content:center; font-weight:bold; font-size:14px;
                        ">
                            ${index + 1}
                        </div>`,
                    iconSize: [28, 28],
                    iconAnchor: [14, 28]
                });

                let marker = L.marker([lat, lng], { icon: icon }).addTo(map);
                markers.push(marker);

                // Click scrolls map
                box.addEventListener("click", () => {
                    map.setView([lat, lng], 12);
                    marker.openPopup();
                });
            }
        });

        // Fit map to markers
        if (markers.length > 0) {
            let group = new L.featureGroup(markers);
            map.fitBounds(group.getBounds());
        }
    </script>

    <!-- Recenter map -->
    <script>
        function recenterMap() {
            if (markers.length > 0) {
                let group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds(), { padding: [50, 50] });
            }
        }
    </script>

    <!-- Toggle √©tape d√©tails -->
    <script>
        document.querySelectorAll('.toggle-details').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();

                const targetId = this.dataset.target;
                const detailsDiv = document.getElementById(targetId);

                const parent = this.closest(".itinerary-content-trip");
                const showLink = parent.querySelector('.toggle-details[data-target="' + targetId + '"]:not(.mt-2)');
                const hideLink = parent.querySelector('.toggle-details.mt-2[data-target="' + targetId + '"]');

                // Si on clique sur "Voir les d√©tails"
                if (this === showLink) {
                    detailsDiv.style.display = "block";
                    showLink.style.display = "none";
                    hideLink.style.display = "inline-block";
                }

                // Si on clique sur "Voir moins"
                else if (this === hideLink) {
                    detailsDiv.style.display = "none";
                    hideLink.style.display = "none";
                    showLink.style.display = "inline-block";
                }
            });
        });


        // Hover effet √©tape
        document.querySelectorAll('.etape-box').forEach(box => {
            box.style.cursor = 'pointer';

            box.addEventListener('mouseenter', function () {
                this.style.backgroundColor = '#f8f9fa';
                this.style.borderRadius = '8px';
                this.style.marginLeft = '-10px';
                this.style.paddingLeft = '100px';
                this.style.transition = 'all 0.2s ease';
            });

            box.addEventListener('mouseleave', function () {
                this.style.backgroundColor = 'transparent';
                this.style.marginLeft = '0';
                this.style.paddingLeft = '90px';
            });
        });
    </script>

    <!-- Counters (version 1) -->
    <script>
        function changeCount(type, delta) {
            const countElem = document.getElementById(type + "-count");
            let value = parseInt(countElem.textContent);
            value = Math.max(0, value + delta);

            if (type === "adult") value = Math.max(1, value);

            countElem.textContent = value;
            updateTravelerText();
        }

        function updateTravelerText() {
            const adult = parseInt(document.getElementById("adult-count").textContent);
            const young = parseInt(document.getElementById("young-count").textContent);
            const child = parseInt(document.getElementById("child-count").textContent);
            const baby = parseInt(document.getElementById("baby-count").textContent);

            let parts = [];

            if (adult > 0) parts.push(adult + " Adulte" + (adult > 1 ? "s" : ""));
            if (young > 0) parts.push(young + " Jeune" + (young > 1 ? "s" : ""));
            if (child > 0) parts.push(child + " Enfant" + (child > 1 ? "s" : ""));
            if (baby > 0) parts.push(baby + " B√©b√©" + (baby > 1 ? "s" : ""));

            document.getElementById("travelers-text").textContent =
                parts.length ? parts.join(", ") : "1 Adulte";
        }
    </script>

    <!-- DatePicker -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            flatpickr("#date-picker", {
                minDate: "today",
                dateFormat: "Y-m-d",
                disableMobile: "true",
                altInput: true,
                altFormat: "d F Y",
                locale: { firstDayOfWeek: 1 }
            });
        });
    </script>

    <!-- Counters (version 2) -->
    <script>
        function changeCount(type, value) {
            const countElement = document.getElementById(type + "-count");
            let count = parseInt(countElement.textContent);

            if (count + value < 0) return;

            count += value;
            countElement.textContent = count;

            updateTotalTravelers();
        }

        function updateTotalTravelers() {
            let adult = parseInt(document.getElementById('adult-count').textContent);
            let young = parseInt(document.getElementById('young-count').textContent);
            let child = parseInt(document.getElementById('child-count').textContent);
            let baby = parseInt(document.getElementById('baby-count').textContent);

            let total = adult + young + child + baby;

            document.getElementById('traveler-total-badge').textContent = total;
        }
    </script>

    <!-- Navigation scroll -->
    <script>
        document.querySelectorAll(".exc-nav-link").forEach(link => {
            link.addEventListener("click", () => {
                const target = document.querySelector(link.getAttribute("data-target"));
                const offset = target.getBoundingClientRect().top + window.scrollY - 100;

                window.scrollTo({
                    top: offset,
                    behavior: "smooth"
                });

                document.querySelectorAll(".exc-nav-link").forEach(l => l.classList.remove("active"));
                link.classList.add("active");

                blockAutoActivation = true;
                setTimeout(() => blockAutoActivation = false, 800);
            });
        });

        let blockAutoActivation = false;

        window.addEventListener("scroll", () => {
            if (blockAutoActivation) return;

            const sections = {
                "#section-description": document.querySelector("#section-description"),
                "#section-details": document.querySelector("#section-details"),
                "#section-itineraire": document.querySelector("#section-itineraire")
            };

            let current = "";
            const scrollPos = window.scrollY + 150;

            for (const key in sections) {
                const secTop = sections[key].offsetTop;
                const secBottom = secTop + sections[key].offsetHeight;

                if (scrollPos >= secTop && scrollPos < secBottom) {
                    current = key;
                }
            }

            document.querySelectorAll(".exc-nav-link").forEach(link => {
                link.classList.remove("active");
                if (link.getAttribute("data-target") === current) {
                    link.classList.add("active");
                }
            });
        });
    </script>

    <!-- Modal zoom images -->
    <script>
        const images = [...document.querySelectorAll('.zoomable-image')];
        let currentIndex = 0;

        const modal = new bootstrap.Modal(document.getElementById('imageModal'));
        const modalImage = document.getElementById('modalImage');

        images.forEach(img => {
            img.addEventListener('click', () => {
                currentIndex = parseInt(img.dataset.index);
                showImage();
                modal.show();
            });
        });

        function showImage() {
            modalImage.src = images[currentIndex].src;
        }

        document.getElementById('prevImage').addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            showImage();
        });

        document.getElementById('nextImage').addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % images.length;
            showImage();
        });

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('imageModal').classList.contains('show')) {
                if (e.key === 'ArrowLeft') {
                    currentIndex = (currentIndex - 1 + images.length) % images.length;
                    showImage();
                }
                if (e.key === 'ArrowRight') {
                    currentIndex = (currentIndex + 1) % images.length;
                    showImage();
                }
            }
        });
    </script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const bars = document.querySelectorAll('.animate-bar');
    bars.forEach(bar => {
        const width = bar.dataset.width;
        bar.style.width = '0';
        setTimeout(() => {
            bar.style.transition = 'width 1s ease-in-out';
            bar.style.width = width;
        }, 100); // petit d√©lai pour d√©clencher l'animation
    });
});
</script>
{% if reservationOK %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const modalEl = document.getElementById('reservationConfirmation');
        if (modalEl) {
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        }
    });
</script>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', () => {
    const isLoggedIn = {{ app.user ? 'true' : 'false' }};

    // Utilisation de delegation pour tous les boutons favorites (y compris charg√©s dynamiquement)
    document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.favorite-btn');

        if (!btn) return; // Si ce n'est pas un bouton favorite, ignorer

        const excursionId = btn.dataset.excursionId;
        const icon = btn.querySelector('i');

        // Si non connect√© ‚Üí ouvrir le modal login
        if (!isLoggedIn) {
            e.preventDefault();
            e.stopPropagation();
            $('#loginModal').modal('show');
            return false;
        }

        // Si connect√© ‚Üí ex√©cuter la requ√™te AJAX pour toggler le favoris
        try {
            const response = await fetch(`/favori/toggle/${excursionId}`, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (data.success) {
                if (data.favori) {
                    icon.classList.remove('far');
                    icon.classList.add('fas', 'text-warning');
                } else {
                    icon.classList.remove('fas', 'text-warning');
                    icon.classList.add('far');
                }
            } else if (data.message) {
                alert(data.message);
            }
        } catch (err) {
            console.error(err);
            alert('Une erreur est survenue.');
        }
    });
});
</script>

<script>
document.querySelectorAll('.faq-question').forEach(button => {
    button.addEventListener('click', () => {
        const item = button.parentElement;
        item.classList.toggle('active');

        const answer = item.querySelector('.faq-answer');
        if(item.classList.contains('active')){
            answer.style.maxHeight = answer.scrollHeight + 'px';
            answer.style.padding = '10px 15px';
        } else {
            answer.style.maxHeight = '0';
            answer.style.padding = '0 15px';
        }

        // Toggle + / -
        const toggle = button.querySelector('.faq-toggle');
        toggle.textContent = item.classList.contains('active') ? '-' : '+';
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {

    // --------- AJAX AJOUT AVIS ---------
    const avisForm = document.getElementById('#formAvis');
    if (avisForm) {
        avisForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(avisForm);
            const url = '{{ path("ajax_add_avis", {"id": excursion.id}) }}';

            fetch(url, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // Ajouter le nouvel avis au d√©but de la liste
                    const avisList = document.querySelector('.avis-list');
                    avisList.insertAdjacentHTML('afterbegin', data.html);

                    // R√©initialiser le formulaire
                    avisForm.reset();
                    // Fermer le modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalAvis'));
                    modal.hide();
                } else {
                    alert('Erreur lors de l\'ajout de l\'avis.');
                }
            })
            .catch(err => console.error(err));
        });
    }

    // --------- AJAX AJOUT FAQ ---------
    const faqForm = document.querySelector('faqForm');
    if (faqForm) {
        faqForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(faqForm);
            const url = '{{ path("ajax_add_faq", {"id": excursion.id}) }}';

            fetch(url, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    const faqAccordion = document.getElementById('faqAccordion');
                    faqAccordion.insertAdjacentHTML('beforeend', data.html);

                    // R√©initialiser le formulaire
                    faqForm.reset();
                } else {
                    alert('Erreur lors de l\'ajout de la question.');
                }
            })
            .catch(err => console.error(err));
        });
    }

});
</script>
<script>
document.getElementById('btnAvis').addEventListener('click', function() {
    var isConnected = {{ is_granted('IS_AUTHENTICATED_FULLY') ? 'true' : 'false' }};
    if (isConnected) {
        var modal = new bootstrap.Modal(document.getElementById('modalAvis'));
        modal.show();
    } else {
        window.location.href = "{{ path('app_login') }}";
    }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const openBtn = document.getElementById('open-chat');
    const chatWidget = document.getElementById('chat-widget');
    const closeBtn = document.getElementById('close-chat');
    const sendBtn = document.getElementById('send-btn');
    const chatInput = document.getElementById('chat-input');
    const messagesBox = document.getElementById('chat-messages');

    openBtn?.addEventListener('click', function(e){
        e.preventDefault();
        chatWidget.style.display = 'flex';
        chatWidget.style.flexDirection = 'column';
        chatInput.focus();
    });

    closeBtn?.addEventListener('click', function(){
        chatWidget.style.display = 'none';
    });

    function appendMessage(text, type='user') {
        const div = document.createElement('div');
        div.className = type === 'user' ? 'message-user' : 'message-admin';
        div.textContent = text;
        messagesBox.appendChild(div);
        messagesBox.scrollTop = messagesBox.scrollHeight;
    }

    sendBtn?.addEventListener('click', function () {
    const msg = chatInput.value.trim();
    if (!msg) return;

    sendBtn.disabled = true;
        const formData = new URLSearchParams();
        formData.append('message', msg);

        fetch('/chat/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: formData.toString()
        })
        .then(resp => resp.json())
        .then(json => {
            sendBtn.disabled = false;
            if (json.status === 'ok' && json.wa_link) {
                appendMessage(msg, 'user');
                chatInput.value = '';

                // ‚úÖ ouvre WhatsApp
                window.open(json.wa_link, '_blank');
            } else {
                appendMessage("Erreur: " + (json.message || "Erreur inconnue"), 'admin');
            }
        })
        .catch(err => {
            sendBtn.disabled = false;
            appendMessage('Erreur r√©seau.', 'admin');
            console.error(err);
        });
    });


    chatInput?.addEventListener('keydown', function(e){
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendBtn.click();
        }
    });
});
</script>

{% endblock %}

